<!DOCTYPE html>  <html lang="fr">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1">  
<title>MiniBook Pro</title>  
<link rel="preconnect" href="https://fonts.googleapis.com">  
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">  
<style>
/* Ù…Ø³Ø§Ø­Ø© Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© Ù„Ù„Ø¥Ø´Ù‡Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.ad-safe-top{
  height:100px;   /* Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø¥Ø°Ø§ Ø§Ù„Ø¥Ø´Ù‡Ø§Ø± Ø£ÙƒØ¨Ø± */
  width:100%;
}
	/* Ø¥ØµÙ„Ø§Ø­ ØµÙˆØ±Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙˆØ³Øª */
.avatar,
.post .avatar img{
  width:48px !important;
  height:48px !important;
  min-width:48px;
  min-height:48px;
  max-width:48px;
  max-height:48px;
  border-radius:50%;
  object-fit:cover;
  flex-shrink:0;
}
/* ===== VARIABLES ===== */
:root{
  --bg:#F4F6FB;
  --card:#ffffff;
  --text:#111827;
  --muted:#6B7280;
  --primary:#4F46E5;
  --secondary:#10B981;
  --danger:#EF4444;
}

body.dark{
  --bg:#0F172A;
  --card:#111827;
  --text:#E5E7EB;
  --muted:#9CA3AF;
  --primary:#6366F1;
  --secondary:#22C55E;
}

/* ===== RESET ===== */
*{box-sizing:border-box}
.hidden{display:none !important}

/* ===== BODY ===== */
body{
  margin:0;
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
	
  

}

/* ===== AUTH ===== */
#auth,#app{width:100%}

#auth{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#667eea,#764ba2);
}

#auth .box{
  max-width:380px;
  width:90%;
  padding:30px;
  border-radius:18px;
  background:#fff;
  box-shadow:0 15px 35px rgba(0,0,0,.25);
}

#auth h3{
  text-align:center;
  color:#4F46E5;
  margin-bottom:20px;
}

#auth input,
#auth button{
  width:100%;
  padding:13px;
  margin-bottom:12px;
  font-size:15px;
  border-radius:10px;
  border:1px solid #ccc;
}

#auth button.primary{
  background:#4F46E5;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
}

#authMsg{
  color:#EF4444;
  text-align:center;
  font-weight:bold;
}

/* ===== NAVBAR ===== */
.navbar{
  display:flex;
  gap:10px;
  padding:10px;
  background:var(--card);
  position:sticky;
  top:0;
  z-index:5; /* Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */
  box-shadow:0 2px 8px rgba(0,0,0,.08);
  border-radius:0 0 14px 14px;
  flex-wrap:wrap;
}

.navbar button{
  flex:1 1 auto;
  padding:9px 14px;
  background:#EEF2FF;
  color:#3730A3;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
  transition:.25s;
}

.navbar button:hover{
  background:var(--primary);
  color:#fff;
}

/* ===== CONTAINER ===== */
.container{
  max-width:950px;
  margin:auto;
  padding:20px;
  margin-top:20px; /* Ø¢Ù…Ù† Ù„Ù„Ø¥Ø´Ù‡Ø§Ø±Ø§Øª */
	
}

/* ===== CARDS ===== */
.box{
  background:var(--card);
  padding:20px;
  border-radius:18px;
  margin-bottom:20px;
  box-shadow:0 8px 20px rgba(0,0,0,.07);
}

/* ===== POSTS ===== */
.post{
  border-bottom:1px solid rgba(0,0,0,.08);
  padding:15px 0;
  position:relative;
  animation:fadeUp .4s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

.post img{
  width:100%;
  height:auto;            /* Ø®Ù„ÙŠ Ø§Ù„Ø·ÙˆÙ„ Ø·Ø¨ÙŠØ¹ÙŠ */
  max-height:420px;       /* Ø­Ø¯ Ø£Ù‚ØµÙ‰ ÙÙ‚Ø· */
  object-fit:contain;     /* ÙŠØ¨ÙŠÙ‘Ù† Ø§Ù„ØµÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© */
  background:#f1f1f1;     /* ÙØ±Ø§Øº Ø£Ù†ÙŠÙ‚ Ø¥Ø°Ø§ Ø§Ù„ØµÙˆØ±Ø© Ø·ÙˆÙŠÙ„Ø© */
  border-radius:14px;
  margin-top:10px;
}

.post img:hover{
  transform:scale(1.02);
}

/* ===== AVATAR ===== */
.avatar{
  width:55px;
  height:55px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid var(--primary);
}

.avatar-placeholder{
  width:45px;
  height:45px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--primary);
  color:#fff;
  font-weight:bold;
}

/* ===== FLEX ===== */
.flex{
  display:flex;
  align-items:center;
  gap:12px;
}

/* ===== CHAT ===== */
.chat-container{
  max-height:320px;
  overflow-y:auto;
  border:1px solid #ddd;
  padding:12px;
  border-radius:14px;
  background:var(--card);
}

.chat-msg{
  max-width:75%;
  padding:8px 12px;
  border-radius:14px;
  margin:6px 0;
  font-size:14px;
  word-wrap:break-word;
}

.chat-msg.me{
  margin-left:auto;
  background:#EDE9FE;
  color:#1E1B4B;
}

.chat-msg.friend{
  background:#DBEAFE;
  color:#1E3A8A;
}

body.dark .chat-msg.me{
  background:#312E81;
  color:#E0E7FF;
}

/* ===== COMMENTS ===== */
.comment input{
  width:70%;
  padding:8px;
  border-radius:10px;
  border:1px solid #ccc;
}

/* ===== USERS ===== */
.user-card{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 0;
  border-bottom:1px solid rgba(0,0,0,.08);
}

.user-card button{
  background:var(--secondary);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:6px 12px;
  cursor:pointer;
}

.user-card button:hover{
  opacity:.9;
}

/* ===== BUTTONS ===== */
button{
  font-family:inherit;
}

.delete-btn{
  position:absolute;
  top:10px;
  right:10px;
  background:var(--danger);
  color:#fff;
  border:none;
  padding:5px 10px;
  border-radius:8px;
  cursor:pointer;
}

/* ===== REACTIONS ===== */
.reaction-box{position:relative;display:flex;gap:8px}

.reactions{
  position:absolute;
  bottom:32px;
  background:var(--card);
  border-radius:18px;
  padding:6px;
  display:none;
  box-shadow:0 6px 18px rgba(0,0,0,.2);
  animation:pop .2s ease;
  z-index:20;
}

@keyframes pop{
  from{transform:scale(.8);opacity:0}
  to{transform:scale(1);opacity:1}
}

.reactions span{
  font-size:22px;
  padding:4px;
  cursor:pointer;
}

.main-like{cursor:pointer}

/* ===== LOADER ===== */
.loader{
  border:6px solid #f3f3f3;
  border-top:6px solid var(--primary);
  border-radius:50%;
  width:40px;
  height:40px;
  animation:spin 1s linear infinite;
  margin:20px auto;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

/* ===== RESPONSIVE ===== */
@media(max-width:768px){
  .post img{max-height:300px}
  .navbar button{font-size:14px;flex:1 1 48%}
  .container{padding:12px}
}

@media(max-width:480px){
  .post img{max-height:220px}
  .navbar button{flex:1 1 100%}
  .chat-msg{font-size:13px}
	  .ad-safe-top{ height:90px; }
}

@media(min-width:481px){
  .ad-safe-top{ height:70px; }
}
</style>
</head>  
<body> 
	<script>
  atOptions = {
    'key' : '90e745df8b4e0b6a32d37aef2b9a5129',
    'format' : 'iframe',
    'height' : 50,
    'width' : 320,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/90e745df8b4e0b6a32d37aef2b9a5129/invoke.js"></script>
	
	
	<div class="ad-safe-top"></div>
  

  <!-- ===== AUTH ===== -->  
  <div id="auth" class="container">  
  <div class="box">  
    <h3>Connexion / Inscription</h3>  
    <input id="username" placeholder="Nom d'utilisateur">  
    <input id="password" type="password" placeholder="Mot de passe">  
    <button class="primary" onclick="login()">Connexion / Inscription</button>  
    <p id="authMsg"></p>  
  </div>  
</div>  <!-- ===== NAVBAR ===== -->  <div id="navbar" class="navbar hidden">  
  <button onclick="openTab('feed')">Fil d'actualitÃ©</button>  
  <button onclick="openTab('profile')">Profil</button>  
  <button onclick="openTab('friends')">Amis</button>  
  <button onclick="openTab('chat')">Chat</button>  
  <button onclick="logout()">DÃ©connexion</button>  
</div>  <!-- ===== APP ===== -->  <div id="app" class="container hidden">  
  <div id="feed" class="box">  
    <textarea id="postText" placeholder="Ã€ quoi pensez-vous ?"></textarea>  
    <input type="file" id="postImage" accept="image/*">  
    <button class="primary" onclick="handlePost(postText.value, postImage.files[0], postText, postImage)">Publier</button>  
	  
    <div id="allPosts" style="min-height:50px; overflow-y:auto; max-height:500px;"></div>  
    <div id="feedLoader" class="loader hidden"></div>  
  </div>    <div id="profile" class="box hidden">  
    <div class="flex">  
      <img id="profilePic" class="avatar" src="">  
      <input type="file" accept="image/*" onchange="uploadAvatar(this)">  
    </div>  
    <textarea id="bio" placeholder="Ã‰crire une bio..."></textarea>  
    <button class="primary" onclick="saveBio()">Enregistrer</button>  
    <textarea id="profilePostText" placeholder="Ã€ quoi pensez-vous ?"></textarea>  
    <input type="file" id="profilePostImage" accept="image/*">  
    <button class="primary" onclick="handlePost(profilePostText.value, profilePostImage.files[0], profilePostText, profilePostImage)">Publier</button>  
	  
    <div id="myPosts" style="min-height:50px; overflow-y:auto; max-height:500px;"></div>  
    <div id="profileLoader" class="loader hidden"></div>  
  </div>    <div id="friends" class="box hidden">  
    <h3>Amis et utilisateurs</h3>  
    <input type="text" id="searchUser" placeholder="Rechercher..." onkeyup="filterUsers()">  
    <div id="allUsers"></div>  
    <div id="friendsLoader" class="loader hidden"></div>  
  </div>    <div id="chat" class="box hidden">  
    <h3>Chat avec les amis</h3>  
    <select id="chatFriendSelect" onchange="loadChat()">  
      <option value="">Choisir un ami</option>  
    </select>  
    <div id="chatContainer" class="chat-container"></div>  
    <textarea id="chatInput" placeholder="Ã‰crire un message"></textarea>  
    <button class="primary" onclick="sendMessage()">Envoyer</button>  
    <div id="chatLoader" class="loader hidden"></div>  
  </div>  
</div>  
	<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/compressorjs/1.1.1/compressor.min.js"></script>
	<script>  
// ===== Firebase Initialization =====  
firebase.initializeApp({  
  apiKey:"AIzaSyAiZsXpUfRB2s__oWRLjjT3yEgZQXOXIuI",  
  databaseURL:"https://book-ee927-default-rtdb.firebaseio.com"  
});  
const db = firebase.database(); 
		
	// ===== SIMPLE ALERT FUNCTION =====
function showAlert(message){
  setTimeout(()=>{
    alert(message);
  }, 300);
}
  
// ===== Global Variables =====  
let user = null;  
let feedCache = [], profileCache = [];  
let currentChatFriend = null;  
  
// ===== DOM Elements =====  
const auth = document.getElementById("auth");  
const navbar = document.getElementById("navbar");  
const app = document.getElementById("app");  
const usernameInput = document.getElementById("username");  
const passwordInput = document.getElementById("password");  
const authMsg = document.getElementById("authMsg");  
const allPosts = document.getElementById("allPosts");  
const myPosts = document.getElementById("myPosts");  
const profilePic = document.getElementById("profilePic");  
const bio = document.getElementById("bio");  
const feedLoader = document.getElementById("feedLoader");  
const profileLoader = document.getElementById("profileLoader");  
const friendsLoader = document.getElementById("friendsLoader");  
const allUsers = document.getElementById("allUsers");  
const chatFriendSelect = document.getElementById("chatFriendSelect");  
const chatContainer = document.getElementById("chatContainer");  
const chatInput = document.getElementById("chatInput");  
const chatLoader = document.getElementById("chatLoader");  
  
// ===== LOGIN / REGISTER =====  
function login(){  
  const u = usernameInput.value.trim();  
  const p = passwordInput.value.trim();  
  if(!u || !p){ authMsg.innerText="Entrez tout"; return; }  
  db.ref("users/"+u).get().then(snap=>{  
    if(!snap.exists()){  
      db.ref("users/"+u).set({pass:p,bio:"",avatar:"",friends:{}}).then(()=>{  
        user=u; localStorage.setItem("user",user); startApp();  
      });  
    } else {  
      if(snap.val().pass!==p){ authMsg.innerText="Mot de passe incorrect"; return; }  
      user=u; localStorage.setItem("user",user); startApp();  
    }  
  }).catch(err=>authMsg.innerText="Erreur: "+err.message);  
}  
  
// ===== START APP =====  
function startApp(){  
  auth.classList.add("hidden");  
  navbar.classList.remove("hidden");  
  app.classList.remove("hidden");  
  openTab('feed');  
  loadFeed();  
  loadProfile();  
  loadAllUsers();  
  loadChatFriends();  

  db.ref(`users/${user}`).get().then(s=>{  
    const data = s.val();  
    profilePic.src=data.avatar||"";  
    bio.value=data.bio||"";  
  });  
	// ØªØ´ØºÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚ Ùˆ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
listenForFriendNotifications();
listenForChatNotifications();
}  
  
// ===== Tab switch =====  
function openTab(id){  
  ['feed','profile','friends','chat'].forEach(t=>document.getElementById(t).classList.add('hidden'));  
  document.getElementById(id).classList.remove('hidden');  
}  
  
// ===== Logout =====  
function logout(){ localStorage.removeItem("user"); location.reload(); }  
  
// ===== Post Handling =====  
	



function handlePost(text, file, textArea, fileInput) {
if (!text && !file) return; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ ÙˆÙ„Ø§ ØµÙˆØ±Ø© â†’ Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¡

const id = Date.now(); // Ù…Ø¹Ø±Ù Ù…Ø¤Ù‚Øª Ù„Ù„Ù…Ù†Ø´ÙˆØ±
feedLoader.classList.remove("hidden");
profileLoader.classList.remove("hidden");

function savePostFinal(img) {
db.ref(`users/${user}`).get()
.then(snapshot => {
const avatar = snapshot.val()?.avatar || "";
db.ref("posts/" + id).set({
user,
userAvatar: avatar,
text,
img,
time: Date.now(),
likes: {},
comments: {}
}).finally(() => {
textArea.value = "";
if (fileInput) fileInput.value = "";
feedLoader.classList.add("hidden");
profileLoader.classList.add("hidden");
});
})
.catch(err => {
console.error("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es utilisateur:", err);
feedLoader.classList.add("hidden");
profileLoader.classList.add("hidden");
});
}

if (file) {
// Ø§Ù„ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ù…Ù„Ù ØµÙˆØ±Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø´Ø±
if (!file.type.startsWith("image/")) {
alert("Erreur : le fichier doit Ãªtre une image !...ÙŠØ¬Ø¨ Ø§Ù† ØªÙƒÙˆÙ† ØµÙˆØ±Ø© ÙÙ‚Ø·...the file most bee photo"); // Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©
if (fileInput) fileInput.value = ""; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„
feedLoader.classList.add("hidden");
profileLoader.classList.add("hidden");
return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¯Ø§Ù„Ø©ØŒ Ù„Ù† ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
}

new Compressor(file, {  
  quality: 0.07,  
  maxWidth: 1024,  
  maxHeight: 1024,  
  success(result) {  
    const reader = new FileReader();  
    reader.onload = function(e) {  
      savePostFinal(e.target.result); // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù€ Base64  
    };  
    reader.readAsDataURL(result);  
  },  
  error(err) {  
    console.error("Erreur lors de la compression de l'image:", err);  
    alert("Erreur lors du traitement de l'image.");  
    feedLoader.classList.add("hidden");  
    profileLoader.classList.add("hidden");  
  }  
});

} else {
savePostFinal(""); // Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØŒ Ø­ÙØ¸ Ø§Ù„Ù†Øµ ÙÙ‚Ø·
}
}
		// ===== Render Post =====  
    
function renderPost(d,id){

// COUNT EMOJIS
let likes = "";
if(d.likes){
const count = {};
Object.values(d.likes).forEach(e=>{
count[e] = (count[e] || 0) + 1;
});
for(const e in count){
likes += `${e} ${count[e]} `;
}
}

// COMMENTS
let commentsHtml = "";
if(d.comments){
for(const c in d.comments){
commentsHtml += `<div class="small"><b>${d.comments[c].user}:</b> ${d.comments[c].text}</div>`;
		}
}

let avatarHTML = d.userAvatar
? `<img src="${d.userAvatar}" class="avatar">`
: `<div class="avatar-placeholder">${d.user[0].toUpperCase()}</div>`;
	
let deleteBtn = d.user===user
? `<button class="delete-btn" onclick="deletePost('${id}')">Supprimer</button>`
: '';

return `

  <div class="post">  
    <div>${avatarHTML} <b>${d.user}</b></div>  
    <p>${d.text||""}</p>  
    ${d.img?`<img src="${d.img}">`:''}  
    ${deleteBtn}  
    <div>${new Date(d.time).toLocaleString()}</div>  <!-- LIKE FACEBOOK STYLE -->  
<div class="reaction-box">  
  <span class="main-like"  
    ontouchstart="showReactions(this)"  
    onmouseenter="showReactions(this)">ğŸ‘</span>  

  <div class="reactions">  
    <span onclick="pickReaction('${id}','ğŸ‘')">ğŸ‘</span>  
    <span onclick="pickReaction('${id}','â¤ï¸')">â¤ï¸</span>  
	<span onclick="pickReaction('${id}','ğŸ¥°')">ğŸ¥°</span>  
	<span onclick="pickReaction('${id}','ğŸ˜­')">ğŸ˜­</span>  
	<span onclick="pickReaction('${id}','ğŸ¤®')">ğŸ¤®</span>  
	<span onclick="pickReaction('${id}','ğŸ”¥')">ğŸ”¥</span>  
	<span onclick="pickReaction('${id}','ğŸŒ¹')">ğŸŒ¹</span>  
    <span onclick="pickReaction('${id}','ğŸ˜‚')">ğŸ˜‚</span>  
    <span onclick="pickReaction('${id}','ğŸ˜®')">ğŸ˜®</span>  
    <span onclick="pickReaction('${id}','ğŸ˜¢')">ğŸ˜¢</span>  
    <span onclick="pickReaction('${id}','ğŸ˜¡')">ğŸ˜¡</span>  
  </div>  

  <span>${likes}</span>  
</div>  

<div>  
  ${commentsHtml}  
  <input placeholder="Commentaire">  
  <button onclick="addComment('${id}',this)">OK</button>  
</div>

  </div>`;  
}  

// ===== LOAD FEED =====  
function loadFeed(){  
  feedLoader.classList.remove("hidden");  
  db.ref("posts").on("value",snap=>{  
    feedCache=[];  
    snap.forEach(p=>{ feedCache.push({key:p.key,val:p.val()}); });  
    feedCache.sort((a,b)=>b.val.time-a.val.time);  
    allPosts.innerHTML="";  
    feedCache.forEach(p=>{ allPosts.innerHTML += renderPost(p.val,p.key); });  
    feedLoader.classList.add("hidden");  
  });  
}  


// ===== LOAD PROFILE POSTS =====  
function loadProfile(){  
  profileLoader.classList.remove("hidden");  
  db.ref("posts").on("value",snap=>{  
    profileCache=[];  
    snap.forEach(p=>{ 
      if(p.val().user===user) 
        profileCache.push({key:p.key,val:p.val()}); 
    });  
    profileCache.sort((a,b)=>b.val.time-a.val.time);  
    myPosts.innerHTML="";  
    profileCache.forEach(p=>{ myPosts.innerHTML += renderPost(p.val,p.key); });  
    profileLoader.classList.add("hidden");  
  });  
}  


// ===== LIKE / COMMENT / DELETE =====  
function deletePost(id){ 
  db.ref("posts/"+id).remove(); 
}  


function toggleLike(postId,emoji){  
  db.ref(`posts/${postId}/likes/${user}`).get().then(s=>{  
    if(s.exists() && s.val()===emoji){ 
      db.ref(`posts/${postId}/likes/${user}`).remove(); 
    }  
    else {
      db.ref(`posts/${postId}/likes/${user}`).set(emoji); 
    }
  });  
}  


function addComment(postId, btn){  
  const input = btn.previousElementSibling;
  const text = input.value.trim();  
  if(!text) return;  

  const commentId = Date.now();  
  db.ref(`posts/${postId}/comments/${commentId}`).set({
    user,
    text
  });  

  input.value="";  
}
// ===== BIO / AVATAR =====  

function saveBio(){
  db.ref(`users/${user}/bio`).set(bio.value);
}

function uploadAvatar(input){
  const file = input.files[0];
  if(!file) return;

  profileLoader.classList.remove("hidden");

  new Compressor(file,{
    quality:0.2,
    maxWidth:512,
    maxHeight:512,
    success(result){

      const reader = new FileReader();
      reader.onload = function(e){
        const url = e.target.result;

        // Ù†Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
        db.ref(`users/${user}/avatar`).set(url)
          .then(()=>{
            profilePic.src = url;
          })
          .finally(()=>{
            profileLoader.classList.add("hidden");
          });
      };

      reader.readAsDataURL(result);
    }
  });
}
// ===== FRIENDS =====

function loadAllUsers(){
  friendsLoader.classList.remove("hidden");
  allUsers.innerHTML = "";

  db.ref("users").get().then(s=>{
    const friendsList = [];
    const othersList = [];
    const promises = [];

    s.forEach(u=>{
      if(u.key === user) return;

      promises.push(
        db.ref(`users/${user}/friends/${u.key}`).get().then(fSnap=>{
          const data = u.val() || {};

          const avatarHTML = data.avatar
            ? `<img src="${data.avatar}" class="avatar">`
            : `<div class="avatar-placeholder" style="background:#6b46c1">
                ${u.key[0].toUpperCase()}
               </div>`;

          const isFriend = fSnap.exists();

          const card = `
            <div class="user-card">
              ${avatarHTML}
              <b>${u.key}</b>
              <button onclick="${isFriend ? 'removeFriend' : 'addFriend'}('${u.key}')">
                ${isFriend ? 'Supprimer' : 'Ajouter'}
              </button>
            </div>
          `;

          if(isFriend){
            friendsList.push(card);
          }else{
            othersList.push(card);
          }
        })
      );
    });

    Promise.all(promises).finally(()=>{
      let html = "";
      if(friendsList.length)
        html += `<h4>Amis</h4>` + friendsList.join("");
      if(othersList.length)
        html += `<h4>Autres utilisateurs</h4>` + othersList.join("");

      allUsers.innerHTML = html;
      friendsLoader.classList.add("hidden");
    });
  });
}


// ===== SEARCH =====

function filterUsers(){
  const val = document.getElementById("searchUser").value.toLowerCase();

  document.querySelectorAll("#allUsers h4").forEach(title=>{
    let next = title.nextElementSibling;
    let visible = false;

    while(next && next.classList.contains("user-card")){
      const name = next.querySelector("b").innerText.toLowerCase();
      const show = name.includes(val);
      next.style.display = show ? "" : "none";
      if(show) visible = true;
      next = next.nextElementSibling;
    }

    title.style.display = visible ? "" : "none";
  });
}


// ===== ADD FRIEND (Ø·Ø±Ù ÙˆØ§Ø­Ø¯ â†’ Ù„Ù„Ø·Ø±ÙÙŠÙ† + Ø¥Ø´Ø¹Ø§Ø±) =====

function addFriend(friend){
  const updates = {};

  // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ø±ÙÙŠÙ†
  updates[`users/${user}/friends/${friend}`] = true;
  updates[`users/${friend}/friends/${user}`] = true;

  // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± ÙÙ‚Ø·
  const notifKey = db.ref(`users/${friend}/notifications`).push().key;
  updates[`users/${friend}/notifications/${notifKey}`] = {
    type: "friend_add",
    from: user,
    time: Date.now()
  };

  db.ref().update(updates).then(()=>{
    loadAllUsers();
    loadChatFriends();
  });
}


// ===== REMOVE FRIEND (Ø·Ø±Ù ÙˆØ§Ø­Ø¯ â†’ Ù„Ù„Ø·Ø±ÙÙŠÙ†) =====

function removeFriend(friend){
  const updates = {};

  updates[`users/${user}/friends/${friend}`] = null;
  updates[`users/${friend}/friends/${user}`] = null;

  db.ref().update(updates).then(()=>{
    loadAllUsers();

    if(currentChatFriend === friend){
      currentChatFriend = null;
      loadChat();
    }

    loadChatFriends();
  });
}

	// ===== FRIEND ADD NOTIFICATIONS =====
function listenForFriendNotifications(){
  if(!user) return;

  db.ref(`users/${user}/notifications`).on("child_added", snap=>{
    const notif = snap.val();
    if(!notif) return;

    if(notif.type === "friend_add"){
      showAlert("ğŸ‘¤ " + notif.from + "  add you / vous ajouter / Ø£Ø¶Ø§ÙÙƒ ÙƒØµØ¯ÙŠÙ‚ ");
    }

    // Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶Ù‡
    snap.ref.remove();
  });
}
	
 //===== CHAT =====  
function loadChatFriends(){  
  db.ref(`users/${user}/friends`).on("value",snap=>{  
    chatFriendSelect.innerHTML='<option value="">Choisir un ami</option>';  
    if(!snap.exists()) return;  
    Object.keys(snap.val()).forEach(f=>{  
      chatFriendSelect.innerHTML += `<option value="${f}">${f}</option>`;  
    });  
  });  
}  
  
function loadChat(){  
  currentChatFriend = chatFriendSelect.value;  
  chatContainer.innerHTML = "";  
  if(!currentChatFriend){ chatLoader.classList.add("hidden"); return; }  
  chatLoader.classList.remove("hidden");  
  const chatId = [user,currentChatFriend].sort().join("_");  
  db.ref(`chats/${chatId}`).off();  
  db.ref(`chats/${chatId}`).on("value",snap=>{  
    chatContainer.innerHTML="";  
    snap.forEach(msg=>{  
      const m = msg.val();  
      const cls = m.from===user?"me":"friend";  
      chatContainer.innerHTML += `<div class="chat-msg ${cls}"><b>${m.from}:</b> ${m.text}</div>`;  
    });  
    chatContainer.scrollTop = chatContainer.scrollHeight;  
    chatLoader.classList.add("hidden");  
  });  
}  
  
function sendMessage(){  
  const text = chatInput.value.trim();  
  if(!text || !currentChatFriend) return;  
  const chatId = [user,currentChatFriend].sort().join("_");  
  const msgId = Date.now();  
  db.ref(`chats/${chatId}/${msgId}`).set({from:user,text,time:Date.now()});  
  chatInput.value="";  
	// ğŸ”” Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
const notifKey = db.ref(`users/${currentChatFriend}/notifications`).push().key;
db.ref(`users/${currentChatFriend}/notifications/${notifKey}`).set({
  type: "chat",
  from: user,
  time: Date.now()
});
}  
  
	// ===== CHAT MESSAGE NOTIFICATIONS =====
function listenForChatNotifications(){
  if(!user) return;

  db.ref(`users/${user}/notifications`).on("child_added", snap=>{
    const notif = snap.val();
    if(!notif) return;

    if(notif.type === "chat"){
      showAlert("ğŸ’¬ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† /new message from / nouveau message apartir " + notif.from);
    }

    // Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶Ù‡
    snap.ref.remove();
  });
}
	
// ===== AUTO LOGIN IF LOCAL =====  
const savedUser = localStorage.getItem("user");  
if(savedUser){   
  user=savedUser;   
  startApp();   
}  
		// =============================
// FACEBOOK STYLE REACTIONS
// =============================

function pickReaction(postId, emoji){
  toggleLike(postId, emoji);
}

function showReactions(el){
  document.querySelectorAll(".reactions").forEach(r=>r.style.display="none");
  el.parentElement.querySelector(".reactions").style.display="flex";
}

document.addEventListener("click", e=>{
  document.querySelectorAll(".reactions").forEach(r=>{
    if(!r.contains(e.target)) r.style.display="none";
  });
});
  </script>  
  
	<script>
  // ===== UI Translation for 3 languages =====
  const uiTexts = {
    "Connexion / Inscription": { "en":"Login / Register", "ar":"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„", "es":"Iniciar sesiÃ³n / Registrarse" },
    "Nom d'utilisateur": { "en":"Username", "ar":"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", "es":"Usuario" },
    "Mot de passe": { "en":"Password", "ar":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "es":"ContraseÃ±a" },
    "Fil d'actualitÃ©": { "en":"Feed", "ar":"Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±", "es":"Noticias" },
    "Profil": { "en":"Profile", "ar":"Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ", "es":"Perfil" },
    "Amis": { "en":"Friends", "ar":"Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", "es":"Amigos" },
    "Chat": { "en":"Chat", "ar":"Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©", "es":"Chat" },
    "DÃ©connexion": { "en":"Logout", "ar":"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", "es":"Cerrar sesiÃ³n" },
    "Ã€ quoi pensez-vous ?": { "en":"What's on your mind?", "ar":"Ø¨Ù… ØªÙÙƒØ±ØŸ", "es":"Â¿En quÃ© piensas?" },
    "Ã‰crire une bio...": { "en":"Write a bio...", "ar":"Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ...", "es":"Escribe una biografÃ­a..." },
    "Enregistrer": { "en":"Save", "ar":"Ø­ÙØ¸", "es":"Guardar" },
    "Rechercher...": { "en":"Search...", "ar":"Ø§Ø¨Ø­Ø«...", "es":"Buscar..." },
    "Choisir un ami": { "en":"Select a friend", "ar":"Ø§Ø®ØªØ± ØµØ¯ÙŠÙ‚", "es":"Selecciona un amigo" },
    "Ã‰crire un message": { "en":"Write a message", "ar":"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©", "es":"Escribe un mensaje" },
    "Envoyer": { "en":"Send", "ar":"Ø¥Ø±Ø³Ø§Ù„", "es":"Enviar" },
    "Supprimer": { "en":"Delete", "ar":"Ø­Ø°Ù", "es":"Eliminar" },
    "Ajouter": { "en":"Add", "ar":"Ø¥Ø¶Ø§ÙØ©", "es":"AÃ±adir" },
    "Commenter": { "en":"Comment", "ar":"ØªØ¹Ù„ÙŠÙ‚", "es":"Comentar" },
  	"Publier": { "en":"Publish", "ar":"Ù†Ø´Ø±", "es":"Comentar" },
  	"Ã‰crire un commentaire": { "en":"Write comment", "ar":"Ø¥ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚", "es":"Comentar" },
  	"Amis et utilisateurs": { "en":"Frends", "ar":"Ø£ØµØ¯Ù‚Ø§Ø¡", "es":"Comentar" },
  	"Autres utilisateurs": { "en":"Other users", "ar":"Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù±Ø®Ø±ÙˆÙ†", "es":"Comentar" },
"Chat avec les amis": { "en":"Chat with frends", "ar":"Ø±Ø§Ø³Ù„ Ø§Ù„Ø§ØµØ¯Ù‚Ø§Ø¡", "es":"Comentarh" },
 "Choisir un ami": { "en":"Use frend", "ar":"Ø§Ø®ØªØ§Ø± ØµØ¯ÙŠÙ‚", "es":"Comentary" },
  	 "Amis": { "en":"Frends", "ar":"Ø£ØµØ¯Ù‚Ø§Ø¡", "es":"Comentary" }
  
  };
  

  function translateUI() {
    const lang = navigator.language.split('-')[0]; // en, ar, es
    // Ø¥Ø°Ø§ Ø§Ù„Ù„ØºØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ù†Ø±Ø¬Ø¹ Ù„Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
    const language = ["en","ar","fr"].includes(lang) ? lang : "en";

    document.querySelectorAll("[placeholder]").forEach(el => {
      const key = el.getAttribute("placeholder");
      if(uiTexts[key] && uiTexts[key][language]) el.setAttribute("placeholder", uiTexts[key][language]);
    });

    document.querySelectorAll("button").forEach(el => {
      if(uiTexts[el.innerText] && uiTexts[el.innerText][language]) el.innerText = uiTexts[el.innerText][language];
    });

    document.querySelectorAll("h3, h4, option").forEach(el => {
      if(uiTexts[el.innerText] && uiTexts[el.innerText][language]) el.innerText = uiTexts[el.innerText][language];
    });
  }

  window.addEventListener("load", translateUI);
		
</script>
	
	<script
  async="async"
  data-cfasync="false"
  src="https://pl28271657.effectivegatecpm.com/7ce278eca43002f8c43475716f0e33ac/invoke.js"
></script>
<div id="container-7ce278eca43002f8c43475716f0e33ac"></div>
<script src="https://pl28271677.effectivegatecpm.com/80/ad/57/80ad5725e11d3a76d1393f090a382411.js"></script>


</body>  
</html>
