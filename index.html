<!DOCTYPE html>  <html lang="fr">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1">  
<title>MiniBook Pro</title>  
<link rel="preconnect" href="https://fonts.googleapis.com">  
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">  
<style>  
*{box-sizing:border-box;}body{margin:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:#f5f7fa;color:#333;}  
.hidden{display:none !important;}  
#auth,#app{width:100%;}  
#auth{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);}  
#auth .box{max-width:400px;width:90%;padding:35px;border-radius:20px;background:#fff;box-shadow:0 15px 35px rgba(0,0,0,0.2);}  
#auth h3{text-align:center;color:#6b46c1;font-size:28px;margin-bottom:25px;}  
#auth input,#auth button{width:100%;padding:14px;margin-bottom:12px;font-size:16px;border-radius:8px;border:1px solid #ccc;}  
#auth button.primary{background:#6b46c1;color:#fff;border:none;cursor:pointer;font-weight:bold;}  
#authMsg{color:#e53e3e;text-align:center;margin-top:10px;font-weight:bold;}  
.navbar{display:flex;gap:12px;padding:12px 20px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10;border-radius:0 0 15px 15px;flex-wrap:wrap;}  
.navbar button{padding:10px 18px;cursor:pointer;background:#f0f0f0;border:none;border-radius:10px;transition: all 0.3s ease;font-weight:bold;flex:1 1 auto;}  
.navbar button:hover{background:#6b46c1;color:#fff;}  
.container{max-width:950px;margin:auto;padding:25px;}  
.box{background:#fff;padding:25px;border-radius:20px;margin-bottom:25px;box-shadow:0 10px 25px rgba(0,0,0,0.08);}  
.avatar{width:60px;height:60px;border-radius:50%;object-fit:cover;margin-right:12px;border:2px solid #6b46c1;}  
.flex{display:flex;align-items:center;gap:12px;}  
.post{border-bottom:1px solid #e0e0e0;padding:15px 0;position:relative;}  
.post img{max-width:100%;border-radius:15px;margin-top:10px;}  
.avatar-placeholder{width:45px;height:45px;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:bold;margin-right:10px;font-size:18px;}  
.chat-container{max-height:320px;overflow-y:auto;border:1px solid #ddd;padding:12px;border-radius:15px;background:#f8f8f8;margin-bottom:12px;}  
.chat-msg.me{text-align:right;margin:5px 0;background:#e9d8fd;padding:8px 12px;border-radius:15px;display:inline-block;}  
.chat-msg.friend{text-align:left;margin:5px 0;background:#d0ebff;padding:8px 12px;border-radius:15px;display:inline-block;}  
.emoji-btn{cursor:pointer;margin-right:6px;transition: transform 0.2s ease;}  
.emoji-btn:hover{transform:scale(1.2);}  
.comment input{width:70%;margin-right:5px;padding:8px;border-radius:10px;border:1px solid #ccc;}  
.user-card{display:flex;align-items:center;gap:12px;margin-bottom:12px;padding:8px 0;border-bottom:1px solid #eee;}  
.user-card button{padding:6px 12px;border:none;border-radius:10px;cursor:pointer;background:#6b46c1;color:#fff;transition:background 0.3s ease;}  
.user-card button:hover{background:#553c9a;}  
textarea{resize:none;border-radius:12px;border:1px solid #ccc;padding:10px;font-family:inherit;}  
.delete-btn{position:absolute;top:10px;right:10px;background:#e53e3e;color:#fff;border:none;padding:5px 10px;border-radius:8px;cursor:pointer;}  
.delete-btn:hover{background:#c53030;}  
.loader{border:6px solid #f3f3f3;border-top:6px solid #6b46c1;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:20px auto;}  
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}  
@media(max-width:768px){.container{margin:15px;padding:15px;}.navbar button{font-size:15px;}}  
@media(max-width:480px){#auth h3{font-size:24px;} input,textarea,button.primary{font-size:14px;padding:12px;}}  
</style>  
</head>  
<body> 
  <script type="text/javascript">
  atOptions = {
  	'key' : '90e745df8b4e0b6a32d37aef2b9a5129',
  	'format' : 'iframe',
  	'height' : 50,
  	'width' : 320,
  	'params' : {}
  };
</script>
<script
  type="text/javascript"
  src="https://www.highperformanceformat.com/90e745df8b4e0b6a32d37aef2b9a5129/invoke.js"
></script>
  <!-- ===== AUTH ===== -->  
  <div id="auth" class="container">  
  <div class="box">  
    <h3>Connexion / Inscription</h3>  
    <input id="username" placeholder="Nom d'utilisateur">  
    <input id="password" type="password" placeholder="Mot de passe">  
    <button class="primary" onclick="login()">Connexion / Inscription</button>  
    <p id="authMsg"></p>  
  </div>  
</div>  <!-- ===== NAVBAR ===== -->  <div id="navbar" class="navbar hidden">  
  <button onclick="openTab('feed')">Fil d'actualitÃ©</button>  
  <button onclick="openTab('profile')">Profil</button>  
  <button onclick="openTab('friends')">Amis</button>  
  <button onclick="openTab('chat')">Chat</button>  
  <button onclick="logout()">DÃ©connexion</button>  
</div>  <!-- ===== APP ===== -->  <div id="app" class="container hidden">  
  <div id="feed" class="box">  
    <textarea id="postText" placeholder="Ã€ quoi pensez-vous ?"></textarea>  
    <input type="file" id="postImage" accept="image/*">  
    <button class="primary" onclick="handlePost(postText.value, postImage.files[0], postText, postImage)">Publier</button>  
    <div id="allPosts" style="min-height:50px; overflow-y:auto; max-height:500px;"></div>  
    <div id="feedLoader" class="loader hidden"></div>  
  </div>    <div id="profile" class="box hidden">  
    <div class="flex">  
      <img id="profilePic" class="avatar" src="">  
      <input type="file" accept="image/*" onchange="uploadAvatar(this)">  
    </div>  
    <textarea id="bio" placeholder="Ã‰crire une bio..."></textarea>  
    <button class="primary" onclick="saveBio()">Enregistrer</button>  
    <textarea id="profilePostText" placeholder="Ã€ quoi pensez-vous ?"></textarea>  
    <input type="file" id="profilePostImage" accept="image/*">  
    <button class="primary" onclick="handlePost(profilePostText.value, profilePostImage.files[0], profilePostText, profilePostImage)">Publier</button>  
    <div id="myPosts" style="min-height:50px; overflow-y:auto; max-height:500px;"></div>  
    <div id="profileLoader" class="loader hidden"></div>  
  </div>    <div id="friends" class="box hidden">  
    <h3>Amis et utilisateurs</h3>  
    <input type="text" id="searchUser" placeholder="Rechercher..." onkeyup="filterUsers()">  
    <div id="allUsers"></div>  
    <div id="friendsLoader" class="loader hidden"></div>  
  </div>    <div id="chat" class="box hidden">  
    <h3>Chat avec les amis</h3>  
    <select id="chatFriendSelect" onchange="loadChat()">  
      <option value="">Choisir un ami</option>  
    </select>  
    <div id="chatContainer" class="chat-container"></div>  
    <textarea id="chatInput" placeholder="Ã‰crire un message"></textarea>  
    <button class="primary" onclick="sendMessage()">Envoyer</button>  
    <div id="chatLoader" class="loader hidden"></div>  
  </div>  
</div>  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/compressorjs/1.1.1/compressor.min.js"></script>  <script>  
// ===== Firebase Initialization =====  
firebase.initializeApp({  
  apiKey:"AIzaSyAiZsXpUfRB2s__oWRLjjT3yEgZQXOXIuI",  
  databaseURL:"https://book-ee927-default-rtdb.firebaseio.com"  
});  
const db = firebase.database(); 
	// ===== SIMPLE ALERT FUNCTION =====
function showAlert(message){
  setTimeout(()=>{
    alert(message);
  }, 300);
}
  
// ===== Global Variables =====  
let user = null;  
let feedCache = [], profileCache = [];  
let currentChatFriend = null;  
  
// ===== DOM Elements =====  
const auth = document.getElementById("auth");  
const navbar = document.getElementById("navbar");  
const app = document.getElementById("app");  
const usernameInput = document.getElementById("username");  
const passwordInput = document.getElementById("password");  
const authMsg = document.getElementById("authMsg");  
const allPosts = document.getElementById("allPosts");  
const myPosts = document.getElementById("myPosts");  
const profilePic = document.getElementById("profilePic");  
const bio = document.getElementById("bio");  
const feedLoader = document.getElementById("feedLoader");  
const profileLoader = document.getElementById("profileLoader");  
const friendsLoader = document.getElementById("friendsLoader");  
const allUsers = document.getElementById("allUsers");  
const chatFriendSelect = document.getElementById("chatFriendSelect");  
const chatContainer = document.getElementById("chatContainer");  
const chatInput = document.getElementById("chatInput");  
const chatLoader = document.getElementById("chatLoader");  
  
// ===== LOGIN / REGISTER =====  
function login(){  
  const u = usernameInput.value.trim();  
  const p = passwordInput.value.trim();  
  if(!u || !p){ authMsg.innerText="Entrez tout"; return; }  
  db.ref("users/"+u).get().then(snap=>{  
    if(!snap.exists()){  
      db.ref("users/"+u).set({pass:p,bio:"",avatar:"",friends:{}}).then(()=>{  
        user=u; localStorage.setItem("user",user); startApp();  
      });  
    } else {  
      if(snap.val().pass!==p){ authMsg.innerText="Mot de passe incorrect"; return; }  
      user=u; localStorage.setItem("user",user); startApp();  
    }  
  }).catch(err=>authMsg.innerText="Erreur: "+err.message);  
}  
  
// ===== START APP =====  
function startApp(){  
  auth.classList.add("hidden");  
  navbar.classList.remove("hidden");  
  app.classList.remove("hidden");  
  openTab('feed');  
  loadFeed();  
  loadProfile();  
  loadAllUsers();  
  loadChatFriends();  

  db.ref(`users/${user}`).get().then(s=>{  
    const data = s.val();  
    profilePic.src=data.avatar||"";  
    bio.value=data.bio||"";  
  });  
	// ØªØ´ØºÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚ Ùˆ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
listenForFriendNotifications();
listenForChatNotifications();
}  
  
// ===== Tab switch =====  
function openTab(id){  
  ['feed','profile','friends','chat'].forEach(t=>document.getElementById(t).classList.add('hidden'));  
  document.getElementById(id).classList.remove('hidden');  
}  
  
// ===== Logout =====  
function logout(){ localStorage.removeItem("user"); location.reload(); }  
  
// ===== Post Handling =====  
	
  function handlePost(text, file, textArea, fileInput) {
  if (!text && !file) return; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ ÙˆÙ„Ø§ ØµÙˆØ±Ø© â†’ Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¡

  const id = Date.now(); // Ù…Ø¹Ø±Ù Ù…Ø¤Ù‚Øª Ù„Ù„Ù…Ù†Ø´ÙˆØ±
  feedLoader.classList.remove("hidden");
  profileLoader.classList.remove("hidden");

  function savePostFinal(img) {
    db.ref(`users/${user}`).get()
      .then(snapshot => {
        const avatar = snapshot.val()?.avatar || "";
        db.ref("posts/" + id).set({
          user,
          userAvatar: avatar,
          text,
          img,
          time: Date.now(),
          likes: {},
          comments: {}
        }).finally(() => {
          textArea.value = "";
          if (fileInput) fileInput.value = "";
          feedLoader.classList.add("hidden");
          profileLoader.classList.add("hidden");
        });
      })
      .catch(err => {
        console.error("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es utilisateur:", err);
        feedLoader.classList.add("hidden");
        profileLoader.classList.add("hidden");
      });
  }

  if (file) {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ù…Ù„Ù ØµÙˆØ±Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø´Ø±
    if (!file.type.startsWith("image/")) {
      alert("Erreur : le fichier doit Ãªtre une image !...ÙŠØ¬Ø¨ Ø§Ù† ØªÙƒÙˆÙ† ØµÙˆØ±Ø© ÙÙ‚Ø·...the file most bee photo"); // Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©
      if (fileInput) fileInput.value = ""; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„
      feedLoader.classList.add("hidden");
      profileLoader.classList.add("hidden");
      return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¯Ø§Ù„Ø©ØŒ Ù„Ù† ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
    }

    new Compressor(file, {
      quality: 0.07,
      maxWidth: 1024,
      maxHeight: 1024,
      success(result) {
        const reader = new FileReader();
        reader.onload = function(e) {
          savePostFinal(e.target.result); // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù€ Base64
        };
        reader.readAsDataURL(result);
      },
      error(err) {
        console.error("Erreur lors de la compression de l'image:", err);
        alert("Erreur lors du traitement de l'image.");
        feedLoader.classList.add("hidden");
        profileLoader.classList.add("hidden");
      }
    });
  } else {
    savePostFinal(""); // Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØŒ Ø­ÙØ¸ Ø§Ù„Ù†Øµ ÙÙ‚Ø·
  }
}
  
// ===== Render Post =====  
function renderPost(d,id){  
  let likes = Object.values(d.likes||{}).join(" ");  
  let commentsHtml = "";  
  if(d.comments){ for(const c in d.comments){ commentsHtml += `<div class="small"><b>${d.comments[c].user}:</b> ${d.comments[c].text}</div>`; } }  
  let avatarHTML = d.userAvatar ? `<img src="${d.userAvatar}" class="avatar">` : `<div class="avatar-placeholder" style="background:#6b46c1">${d.user[0].toUpperCase()}</div>`;  
  let deleteBtn = d.user===user ? `<button class="delete-btn" onclick="deletePost('${id}')">Supprimer</button>` : '';  
  return `<div class="post">  
    <div class="flex">${avatarHTML}<b>${d.user}</b></div>  
    <p>${d.text||""}</p>  
    ${d.img?`<img src="${d.img}">`:''}  
    ${deleteBtn}  
    <div class="small">${new Date(d.time).toLocaleString()}</div>  
    <div><span class="emoji-btn" onclick="toggleLike('${id}','ğŸ‘')">ğŸ‘</span><span class="emoji-btn" onclick="toggleLike('${id}','â¤ï¸')">â¤ï¸</span><span class="emoji-btn" onclick="toggleLike('${id}','ğŸ˜‚')">ğŸ˜‚</span><span>${likes}</span></div>  
    <div class="comment">${commentsHtml}<input placeholder="Ã‰crire un commentaire..." id="c${id}"><button onclick="addComment('${id}')">Commenter</button></div>  
  </div>`;  
}  
  // ===== LOAD FEED =====  
function loadFeed(){  
  feedLoader.classList.remove("hidden");  
  db.ref("posts").on("value",snap=>{  
    feedCache=[];  
    snap.forEach(p=>{ feedCache.push({key:p.key,val:p.val()}); });  
    feedCache.sort((a,b)=>b.val.time-a.val.time);  
    allPosts.innerHTML="";  
    feedCache.forEach(p=>{ allPosts.innerHTML += renderPost(p.val,p.key); });  
    feedLoader.classList.add("hidden");  
  });  
}  
  
// ===== LOAD PROFILE POSTS =====  
function loadProfile(){  
  profileLoader.classList.remove("hidden");  
  db.ref("posts").on("value",snap=>{  
    profileCache=[];  
    snap.forEach(p=>{ if(p.val().user===user) profileCache.push({key:p.key,val:p.val()}); });  
    profileCache.sort((a,b)=>b.val.time-a.val.time);  
    myPosts.innerHTML="";  
    profileCache.forEach(p=>{ myPosts.innerHTML += renderPost(p.val,p.key); });  
    profileLoader.classList.add("hidden");  
  });  
}  
  
// ===== LIKE / COMMENT / DELETE =====  
function deletePost(id){ db.ref("posts/"+id).remove(); }  
  
function toggleLike(postId,emoji){  
  db.ref(`posts/${postId}/likes/${user}`).get().then(s=>{  
    if(s.exists() && s.val()===emoji){ db.ref(`posts/${postId}/likes/${user}`).remove(); }  
    else db.ref(`posts/${postId}/likes/${user}`).set(emoji);  
  });  
}  
  
function addComment(postId){  
  const input=document.getElementById("c"+postId);  
  const text=input.value.trim();  
  if(!text) return;  
  const commentId=Date.now();  
  db.ref(`posts/${postId}/comments/${commentId}`).set({user,text});  
  input.value="";  
}  
  
// ===== BIO / AVATAR =====  

function saveBio(){
  db.ref(`users/${user}/bio`).set(bio.value);
}

function uploadAvatar(input){
  const file = input.files[0];
  if(!file) return;

  profileLoader.classList.remove("hidden");

  new Compressor(file,{
    quality:0.2,
    maxWidth:512,
    maxHeight:512,
    success(result){

      const reader = new FileReader();
      reader.onload = function(e){
        const url = e.target.result;

        // Ù†Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
        db.ref(`users/${user}/avatar`).set(url)
          .then(()=>{
            profilePic.src = url;
          })
          .finally(()=>{
            profileLoader.classList.add("hidden");
          });
      };

      reader.readAsDataURL(result);
    }
  });
}
// ===== FRIENDS =====

function loadAllUsers(){
  friendsLoader.classList.remove("hidden");
  allUsers.innerHTML = "";

  db.ref("users").get().then(s=>{
    const friendsList = [];
    const othersList = [];
    const promises = [];

    s.forEach(u=>{
      if(u.key === user) return;

      promises.push(
        db.ref(`users/${user}/friends/${u.key}`).get().then(fSnap=>{
          const data = u.val() || {};

          const avatarHTML = data.avatar
            ? `<img src="${data.avatar}" class="avatar">`
            : `<div class="avatar-placeholder" style="background:#6b46c1">
                ${u.key[0].toUpperCase()}
               </div>`;

          const isFriend = fSnap.exists();

          const card = `
            <div class="user-card">
              ${avatarHTML}
              <b>${u.key}</b>
              <button onclick="${isFriend ? 'removeFriend' : 'addFriend'}('${u.key}')">
                ${isFriend ? 'Supprimer' : 'Ajouter'}
              </button>
            </div>
          `;

          if(isFriend){
            friendsList.push(card);
          }else{
            othersList.push(card);
          }
        })
      );
    });

    Promise.all(promises).finally(()=>{
      let html = "";
      if(friendsList.length)
        html += `<h4>Amis</h4>` + friendsList.join("");
      if(othersList.length)
        html += `<h4>Autres utilisateurs</h4>` + othersList.join("");

      allUsers.innerHTML = html;
      friendsLoader.classList.add("hidden");
    });
  });
}


// ===== SEARCH =====

function filterUsers(){
  const val = document.getElementById("searchUser").value.toLowerCase();

  document.querySelectorAll("#allUsers h4").forEach(title=>{
    let next = title.nextElementSibling;
    let visible = false;

    while(next && next.classList.contains("user-card")){
      const name = next.querySelector("b").innerText.toLowerCase();
      const show = name.includes(val);
      next.style.display = show ? "" : "none";
      if(show) visible = true;
      next = next.nextElementSibling;
    }

    title.style.display = visible ? "" : "none";
  });
}


// ===== ADD FRIEND (Ø·Ø±Ù ÙˆØ§Ø­Ø¯ â†’ Ù„Ù„Ø·Ø±ÙÙŠÙ† + Ø¥Ø´Ø¹Ø§Ø±) =====

function addFriend(friend){
  const updates = {};

  // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ø±ÙÙŠÙ†
  updates[`users/${user}/friends/${friend}`] = true;
  updates[`users/${friend}/friends/${user}`] = true;

  // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± ÙÙ‚Ø·
  const notifKey = db.ref(`users/${friend}/notifications`).push().key;
  updates[`users/${friend}/notifications/${notifKey}`] = {
    type: "friend_add",
    from: user,
    time: Date.now()
  };

  db.ref().update(updates).then(()=>{
    loadAllUsers();
    loadChatFriends();
  });
}


// ===== REMOVE FRIEND (Ø·Ø±Ù ÙˆØ§Ø­Ø¯ â†’ Ù„Ù„Ø·Ø±ÙÙŠÙ†) =====

function removeFriend(friend){
  const updates = {};

  updates[`users/${user}/friends/${friend}`] = null;
  updates[`users/${friend}/friends/${user}`] = null;

  db.ref().update(updates).then(()=>{
    loadAllUsers();

    if(currentChatFriend === friend){
      currentChatFriend = null;
      loadChat();
    }

    loadChatFriends();
  });
}

	// ===== FRIEND ADD NOTIFICATIONS =====
function listenForFriendNotifications(){
  if(!user) return;

  db.ref(`users/${user}/notifications`).on("child_added", snap=>{
    const notif = snap.val();
    if(!notif) return;

    if(notif.type === "friend_add"){
      showAlert("ğŸ‘¤ " + notif.from + "  add you / vous ajouter / Ø£Ø¶Ø§ÙÙƒ ÙƒØµØ¯ÙŠÙ‚ ");
    }

    // Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶Ù‡
    snap.ref.remove();
  });
}
	
 //===== CHAT =====  
function loadChatFriends(){  
  db.ref(`users/${user}/friends`).on("value",snap=>{  
    chatFriendSelect.innerHTML='<option value="">Choisir un ami</option>';  
    if(!snap.exists()) return;  
    Object.keys(snap.val()).forEach(f=>{  
      chatFriendSelect.innerHTML += `<option value="${f}">${f}</option>`;  
    });  
  });  
}  
  
function loadChat(){  
  currentChatFriend = chatFriendSelect.value;  
  chatContainer.innerHTML = "";  
  if(!currentChatFriend){ chatLoader.classList.add("hidden"); return; }  
  chatLoader.classList.remove("hidden");  
  const chatId = [user,currentChatFriend].sort().join("_");  
  db.ref(`chats/${chatId}`).off();  
  db.ref(`chats/${chatId}`).on("value",snap=>{  
    chatContainer.innerHTML="";  
    snap.forEach(msg=>{  
      const m = msg.val();  
      const cls = m.from===user?"me":"friend";  
      chatContainer.innerHTML += `<div class="chat-msg ${cls}"><b>${m.from}:</b> ${m.text}</div>`;  
    });  
    chatContainer.scrollTop = chatContainer.scrollHeight;  
    chatLoader.classList.add("hidden");  
  });  
}  
  
function sendMessage(){  
  const text = chatInput.value.trim();  
  if(!text || !currentChatFriend) return;  
  const chatId = [user,currentChatFriend].sort().join("_");  
  const msgId = Date.now();  
  db.ref(`chats/${chatId}/${msgId}`).set({from:user,text,time:Date.now()});  
  chatInput.value="";  
	// ğŸ”” Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
const notifKey = db.ref(`users/${currentChatFriend}/notifications`).push().key;
db.ref(`users/${currentChatFriend}/notifications/${notifKey}`).set({
  type: "chat",
  from: user,
  time: Date.now()
});
}  
  
	// ===== CHAT MESSAGE NOTIFICATIONS =====
function listenForChatNotifications(){
  if(!user) return;

  db.ref(`users/${user}/notifications`).on("child_added", snap=>{
    const notif = snap.val();
    if(!notif) return;

    if(notif.type === "chat"){
      showAlert("ğŸ’¬ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† /new message from / nouveau message apartir " + notif.from);
    }

    // Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶Ù‡
    snap.ref.remove();
  });
}
	
// ===== AUTO LOGIN IF LOCAL =====  
const savedUser = localStorage.getItem("user");  
if(savedUser){   
  user=savedUser;   
  startApp();   
}  
  </script>  
  
	<script>
  // ===== UI Translation for 3 languages =====
  const uiTexts = {
    "Connexion / Inscription": { "en":"Login / Register", "ar":"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„", "es":"Iniciar sesiÃ³n / Registrarse" },
    "Nom d'utilisateur": { "en":"Username", "ar":"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", "es":"Usuario" },
    "Mot de passe": { "en":"Password", "ar":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "es":"ContraseÃ±a" },
    "Fil d'actualitÃ©": { "en":"Feed", "ar":"Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±", "es":"Noticias" },
    "Profil": { "en":"Profile", "ar":"Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ", "es":"Perfil" },
    "Amis": { "en":"Friends", "ar":"Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", "es":"Amigos" },
    "Chat": { "en":"Chat", "ar":"Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©", "es":"Chat" },
    "DÃ©connexion": { "en":"Logout", "ar":"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", "es":"Cerrar sesiÃ³n" },
    "Ã€ quoi pensez-vous ?": { "en":"What's on your mind?", "ar":"Ø¨Ù… ØªÙÙƒØ±ØŸ", "es":"Â¿En quÃ© piensas?" },
    "Ã‰crire une bio...": { "en":"Write a bio...", "ar":"Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ...", "es":"Escribe una biografÃ­a..." },
    "Enregistrer": { "en":"Save", "ar":"Ø­ÙØ¸", "es":"Guardar" },
    "Rechercher...": { "en":"Search...", "ar":"Ø§Ø¨Ø­Ø«...", "es":"Buscar..." },
    "Choisir un ami": { "en":"Select a friend", "ar":"Ø§Ø®ØªØ± ØµØ¯ÙŠÙ‚", "es":"Selecciona un amigo" },
    "Ã‰crire un message": { "en":"Write a message", "ar":"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©", "es":"Escribe un mensaje" },
    "Envoyer": { "en":"Send", "ar":"Ø¥Ø±Ø³Ø§Ù„", "es":"Enviar" },
    "Supprimer": { "en":"Delete", "ar":"Ø­Ø°Ù", "es":"Eliminar" },
    "Ajouter": { "en":"Add", "ar":"Ø¥Ø¶Ø§ÙØ©", "es":"AÃ±adir" },
    "Commenter": { "en":"Comment", "ar":"ØªØ¹Ù„ÙŠÙ‚", "es":"Comentar" },
  	"Publier": { "en":"Publish", "ar":"Ù†Ø´Ø±", "es":"Comentar" },
  	"Ã‰crire un commentaire": { "en":"Write comment", "ar":"Ø¥ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚", "es":"Comentar" },
  	"Amis et utilisateurs": { "en":"Frends", "ar":"Ø£ØµØ¯Ù‚Ø§Ø¡", "es":"Comentar" },
  	"Autres utilisateurs": { "en":"Other users", "ar":"Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù±Ø®Ø±ÙˆÙ†", "es":"Comentar" },
"Chat avec les amis": { "en":"Chat with frends", "ar":"Ø±Ø§Ø³Ù„ Ø§Ù„Ø§ØµØ¯Ù‚Ø§Ø¡", "es":"Comentarh" },
 "Choisir un ami": { "en":"Use frend", "ar":"Ø§Ø®ØªØ§Ø± ØµØ¯ÙŠÙ‚", "es":"Comentary" },
  	 "Amis": { "en":"Frends", "ar":"Ø£ØµØ¯Ù‚Ø§Ø¡", "es":"Comentary" }
  
  };
  

  function translateUI() {
    const lang = navigator.language.split('-')[0]; // en, ar, es
    // Ø¥Ø°Ø§ Ø§Ù„Ù„ØºØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ù†Ø±Ø¬Ø¹ Ù„Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
    const language = ["en","ar","fr"].includes(lang) ? lang : "en";

    document.querySelectorAll("[placeholder]").forEach(el => {
      const key = el.getAttribute("placeholder");
      if(uiTexts[key] && uiTexts[key][language]) el.setAttribute("placeholder", uiTexts[key][language]);
    });

    document.querySelectorAll("button").forEach(el => {
      if(uiTexts[el.innerText] && uiTexts[el.innerText][language]) el.innerText = uiTexts[el.innerText][language];
    });

    document.querySelectorAll("h3, h4, option").forEach(el => {
      if(uiTexts[el.innerText] && uiTexts[el.innerText][language]) el.innerText = uiTexts[el.innerText][language];
    });
  }

  window.addEventListener("load", translateUI);
</script>
	<script
  async="async"
  data-cfasync="false"
  src="https://pl28271657.effectivegatecpm.com/7ce278eca43002f8c43475716f0e33ac/invoke.js"
></script>
<div id="container-7ce278eca43002f8c43475716f0e33ac"></div>
<script src="https://pl28271677.effectivegatecpm.com/80/ad/57/80ad5725e11d3a76d1393f090a382411.js"></script>
</body>  
</html>
