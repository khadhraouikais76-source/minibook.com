<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Firebase Old Posts Cleaner</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#1a202c,#2d3748);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}
.box{
  background:#111827;
  padding:30px;
  border-radius:16px;
  max-width:420px;
  width:90%;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
  text-align:center;
}
h2{margin-bottom:10px;}
p{font-size:14px;opacity:.9;}
button{
  margin-top:20px;
  width:100%;
  padding:14px;
  font-size:16px;
  font-weight:bold;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background:#ef4444;
  color:#fff;
}
button:hover{background:#dc2626;}
#status{
  margin-top:15px;
  font-size:14px;
}
</style>
</head>
<body>

<div class="box">
  <h2>ğŸ§¹ Ø­Ø°Ù Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</h2>
  <p>
    Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± ÙŠØ­Ø°Ù <b>Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£Ù‚Ø¯Ù… ÙÙ‚Ø·</b><br>
    Ù…Ù† Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª
  </p>
  <button onclick="deleteOldHalfPosts()">
    Ø­Ø°Ù Ø§Ù„Ù†ØµÙ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø§Ù„Ø¢Ù†
  </button>
  <div id="status"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ğŸ”§ Ø¹Ø¯Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Firebase ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ø²Ù…
firebase.initializeApp({
  apiKey: "AIzaSyAiZsXpUfRB2s__oWRLjjT3yEgZQXOXIuI",
  databaseURL: "https://book-ee927-default-rtdb.firebaseio.com"
});

const db = firebase.database();
const statusBox = document.getElementById("status");

// ğŸš¨ Ø­Ø°Ù Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£Ù‚Ø¯Ù… ÙÙ‚Ø·
function deleteOldHalfPosts(){

  if(!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† Ø§Ù„Ø¨ÙˆØ³ØªØ§ØªØŸ")) return;

  statusBox.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª...";

  db.ref("posts").get().then(snapshot=>{
    if(!snapshot.exists()){
      statusBox.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙˆØ³ØªØ§Øª";
      return;
    }

    const posts = [];

    snapshot.forEach(p=>{
      posts.push({
        id: p.key,
        time: p.val().time || 0
      });
    });

    posts.sort((a,b)=>a.time - b.time);

    const half = Math.floor(posts.length / 2);
    const oldPosts = posts.slice(0, half);

    if(oldPosts.length === 0){
      statusBox.innerHTML = "â„¹ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø§ ÙŠÙØ­Ø°Ù";
      return;
    }

    const updates = {};
    oldPosts.forEach(p=>{
      updates["posts/" + p.id] = null;
    });

    statusBox.innerHTML = "ğŸ§¹ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù " + oldPosts.length + " Ø¨ÙˆØ³Øª...";

    db.ref().update(updates).then(()=>{
      statusBox.innerHTML = "âœ… ØªÙ… Ø­Ø°Ù " + oldPosts.length + " Ø¨ÙˆØ³Øª Ù‚Ø¯ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­";
    }).catch(err=>{
      console.error(err);
      statusBox.innerHTML = "âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù";
    });

  }).catch(err=>{
    console.error(err);
    statusBox.innerHTML = "âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
  });
}
</script>

</body>
</html>